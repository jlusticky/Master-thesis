%=========================================================================
% (c) 2014, 2015 Josef Lusticky

\chapter{Measurements}\label{chap:measurements}
The results presented in this thesis are based on the setup and basic settings described in chapter~\ref{chap:setup}.
The CentOS~7 operating system
was installed on the server with two Intel Xeon E5-2660 v3 CPUs
and Mellanox ConnectX-3 EN 40~Gbps ethernet adapter, as described in section~\ref{sec:analysis-hardware}.
Each measurement put the server under 60~seconds of constant unidirectional traffic load,
as described in section~\ref{sec:analysis-metodology}.
Unless stated otherwise,
the bandwidth use is configured in frames per second with a unit of margin 50~000.

\section{CentOS~7 distribution kernel 3.10.0-123}
The CentOS~7 distribution kernel version 3.10.0-123.20.1.el7.x86\_64
was used in the measurements presented in this section.

	\input{measurements/el7/m1.tex}
	
	\input{measurements/el7/m2.tex}
	
	\input{measurements/el7/m3.tex}
	
	\input{measurements/el7/m4.tex}
	
	\input{measurements/el7/m5.tex}
	
	\input{measurements/el7/m6.tex}
	
	\input{measurements/el7/m7.tex}
	
	\input{measurements/el7/m8.tex}

	\input{measurements/el7/m9.tex}

	\input{measurements/el7/m10.tex}


\section{Upstream mainline kernel 3.19.2}

	\input{measurements/ml/m9.tex}
	
	\input{measurements/ml/m10.tex}
	
 119:          0          0          0          0          0          0          0          0          0          0     898301          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-0
 120:          0          0          0          0          0          0          0          0          0          0          0     898306          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-1
 121:          0          0          0          0          0          0          0          0          0          0          7          0     898211          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-2
 122:          0          0          0          0          0          0          0          0          0          0          0          0          0     898326          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-3
 123:          0          0          0          0          0          0          0          0          0          0          1          0          0          0     898326          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-4
 124:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     898316          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-5
 125:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     898345          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-6
 126:          0          0          0          0          0          0          0          0          0          0         11          0          0          0          0          0          0     898343          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-7
 127:          0          0          0          0          0          0          0          0          0          0     345492          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-0
 128:          0          0          0          0          0          0          0          0          0          0          0     345496          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-1
 129:          0          0          0          0          0          0          0          0          0          0          7          0     345509          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-2
 130:          0          0          0          0          0          0          0          0          0          0          0          0          0     345559          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-3
 131:          0          0          0          0          0          0          0          0          0          0          1          0          0          0     345520          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-4
 132:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     345509          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-5
 133:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     345571          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-6
 134:          0          0          0          0          0          0          0          0          0          0         12          0          0          0          0          0          0     357693          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-7
 135:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357699          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-8
 136:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357702          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-9
 137:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357669          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-10
 138:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357692          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-11
 139:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357689          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-12
 140:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357693          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-13
 141:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357660          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0-14
 142:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     357672          0          0          0          0  IR-PCI-MSI-edge      enp129s0-15
 143:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910496          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-8
 144:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910512          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-9
 145:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910507          0          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-10
 146:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910509          0          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-11
 147:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910508          0          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-12
 148:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910511          0          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-13
 149:          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910514          0          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-14
 150:          0          0          0          0          0          0          0          0          0          0          1          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0          0     910511          0          0          0          0  IR-PCI-MSI-edge      enp129s0d1-15
 

\section{Settings influence}

	\input{measurements/ht.tex}
	
The following measurements take only the AMS-IX distribution and 32 IPv4 flows into account.
The measurements are performed with HT disabled,
therefore the previous result of 5~900~000 frames per second can be used for comparision.

	\input{measurements/netdev_budget.tex}

	\input{measurements/rp_filter.tex}

% se starsim kernelem
	\input{measurements/selinux.tex}

	%netfilter - connection tracking
	%netfilter 1000 ip table rules
	%netfilter - masquerade == nat

\section{CentOS~7 distribution kernel 3.10.0-229.1.2}
The CentOS~7 distribution kernel 3.10.0-229.1.2.el7.x86\_64
was used in the measurements presented in this section.
This is the latest kernel version available as of 3rd May 2015.
This version fixes the problem with IRQ allocation in the mlx4 driver.

This allows to use up to 16 queues with RSS.
The Hyper-Threading must be enabled in order to have at least 16 cores.
%TODO 16 front + HT

\section{BGP routes}

	\input{measurements/bgp.tex}
